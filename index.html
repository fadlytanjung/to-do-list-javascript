<!DOCTYPE html>
<html>

<head>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css" />
</head>

<body>
  <main>
    <div id="wrapper" class="header">
      <h2>My Todo List</h2>
      <div class="input-wrapper">
        <input type="text" id="input-field" placeholder="Title...">
        <button onclick="addTodo()">Add</button>
      </div>
    </div>
    <ul id="list-todo" class="todo-wrapper">
      <!-- <li>
        <div class="input-label">
          <input type="checkbox">
          <label>
            Todo 1
          </label>
        </div>
        <span class="close">x</span>
      </li> -->
    </ul>
    <table style="border-collapse: collapse; width: 100%" border="1">
      <thead>
        <th>NO</th>
        <th>BOROUGH</th>
        <th>ADDRESS</th>
        <th>LOT</th>
        <th>SALE PRICE</th>
      </thead>
      <tbody id="data">
      </tbody>
    </table>
  </main>
  <script>
    const listTodo = document.getElementById("list-todo");
    const inputElement = document.getElementById("input-field");
    const wrapper = document.getElementById("wrapper");
    const dataTable = document.getElementById("data");

    let page = 2;
    let limit = 10;

    fetch("./data/data-tim-12.json")
      .then((res) => {
        if (!res.ok) {
          throw new Error
            (`HTTP error! Status: ${res.status}`);
        }
        return res.json();
      })
      .then((data) => {
        const filteredData = data.filter((el) => el['SALE PRICE'] >= 200000)
          .sort((a, b) => b['SALE PRICE'] - a['SALE PRICE']);
  
        let dataBody = "";

        for (let i = 0; i < filteredData.length; i++) {
          if (i >= (page - 1) * limit && i < limit * page) {
            dataBody += `
              <tr>
                <td>${i + 1}</td>
                <td>${filteredData[i].BOROUGH}</td>
                <td>${filteredData[i].ADDRESS}</td>
                <td>${filteredData[i].LOT}</td>
                <td>${filteredData[i]['SALE PRICE']}</td>
              </tr>
              `;
          }
        }
        // listTodo.innerHTML += `
        //   <li>
        //     <div class="input-label">
        //       <input
        //         type="checkbox"
        //         onchange="checkedTodo(this)"
        //       >
        //       <label>
        //         ${BOROUGH} | ${ADDRESS}
        //       </label>
        //     </div>
        //     <span class="close" onclick="removeTodo(this)">x</span>
        //   </li>`;
        dataTable.innerHTML = dataBody;
      })
      .catch((error) => {
        console.log({ error })
        alert("Error: " + JSON.stringify(error));
      });

    // add new todo item
    function addTodo() {
      const inputValue = inputElement.value;

      if (inputValue.length < 1) {
        // add error class
        inputElement.classList.add("error-input");

        // create span element error
        const errorElement = document.createElement('span');
        // add class error message
        errorElement.classList.add('error-message');
        // add text error message
        errorElement.innerHTML = 'Please enter a todo.';
        // append error element to wrapper
        wrapper.appendChild(errorElement);
        return; // stop the function
      }

      inputElement.classList.remove("error-input");
      const errorElement = wrapper.querySelector('.error-message');

      if (errorElement) {
        wrapper.removeChild(errorElement);
      }

      const li = document.createElement('li');
      const div = document.createElement('div');
      const input = document.createElement('input');
      const label = document.createElement('label');
      const span = document.createElement('span');

      div.classList.add('input-label');
      label.innerHTML = inputValue;

      input.type = 'checkbox';
      input.onchange = function () {
        checkedTodo(this);
      };

      span.innerHTML = 'x';
      span.classList.add('close');
      span.onclick = function () {
        removeTodo(this);
      };

      div.appendChild(input);
      div.appendChild(label);

      li.appendChild(div);
      li.appendChild(span);
      listTodo.appendChild(li);

      inputElement.value = '';
    };

    // remove todo by binding item
    function removeTodo(elem) {
      elem.parentElement.remove();
    };

    function checkedTodo(elem) {
      const label = elem.nextElementSibling;
      if (elem.checked) {
        elem.checked = "checked";
        label.style.textDecoration = 'line-through';
      } else {
        elem.checked = false;
        label.style.textDecoration = 'none';
      }
    }
  </script>

</body>

</html>